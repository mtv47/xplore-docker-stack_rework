---------------------
Stock commands
---------------------
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia --target gazebo_nvidia .
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/docker_commons:humble-desktop --target xplore_common .
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop

docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/elec:humble-desktop -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/cs:humble-desktop -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain --target build-rover -t ghcr.io/epflxplore/rover:humble-desktop -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/hd:humble-desktop -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/nav:humble-desktop -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/sc:humble-desktop -f Dockerfile ..
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/elec:humble-desktop
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/cs:humble-desktop
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/rover:humble-desktop
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/hd:humble-desktop
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop

---------------------
Stock docker_commons images sizes:
---------------------
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons/docker_humble_desktop$ docker image ls
                                                                                                       i Info →   U  In Use
IMAGE                                                     ID             DISK USAGE   CONTENT SIZE   EXTRA
ghcr.io/epflxplore/docker_commons:humble-desktop          54a06a039c9c       4.04GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia   ebf9e46a1106         13GB             0B        
hello-world:latest                                        1b44b5a3e06a       10.1kB             0B    U   
ubuntu:22.04                                              9fa3e2b5204f       77.9MB             0B        
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons/docker_humble_desktop$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia
13041898362
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons/docker_humble_desktop$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop
4041585083

-------------------
Stock containers sizes:
-------------------
mtv@x570:~/Documents/GitHub/docker-rework$ docker image ls
                                                                                                       i Info →   U  In Use
IMAGE                                                     ID             DISK USAGE   CONTENT SIZE   EXTRA
ghcr.io/epflxplore/cs:humble-desktop                      d49a3f7c2bbb       4.36GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop          54a06a039c9c       4.04GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia   ebf9e46a1106         13GB             0B        
ghcr.io/epflxplore/elec:humble-desktop                    fb5c1560386b       6.88GB             0B        
ghcr.io/epflxplore/hd:humble-desktop                      0a32b26aa072         13GB             0B        
ghcr.io/epflxplore/nav:humble-desktop                     e58dea28d4b2       16.4GB             0B        
ghcr.io/epflxplore/rover:humble-desktop                   ca941c4d097b       4.82GB             0B        
ghcr.io/epflxplore/sc:humble-desktop                      dd3ed1638de6       13.1GB             0B        
hello-world:latest                                        1b44b5a3e06a       10.1kB             0B    U   
ubuntu:22.04                                              9fa3e2b5204f       77.9MB             0B        
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/elec:humble-desktop
6880712353
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/cs:humble-desktop
4364438182
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/rover:humble-desktop
4824186019
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/hd:humble-desktop
12963319833
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop
16406183416
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop
13121639926

---------------------
New commands
---------------------
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-new --target gazebo_nvidia .
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/docker_commons:humble-desktop-new --target xplore_common .
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-new

docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/elec:humble-desktop-new -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/cs:humble-desktop-new -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain --target build-rover -t ghcr.io/epflxplore/rover:humble-desktop-new -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/hd:humble-desktop-new -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/nav:humble-desktop-new -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/sc:humble-desktop-new -f Dockerfile ..
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/elec:humble-desktop-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/cs:humble-desktop-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/rover:humble-desktop-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/hd:humble-desktop-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop-new
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop-new

---------------------
New docker_commons images sizes:
---------------------
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons_new/docker_humble_desktop$ docker image ls
                                                                                                       i Info →   U  In Use
IMAGE                                                         ID             DISK USAGE   CONTENT SIZE   EXTRA
ghcr.io/epflxplore/docker_commons:humble-desktop-new          659658da7cfd       3.85GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-new   1dc8571d29ff       12.7GB             0B        
hello-world:latest                                            1b44b5a3e06a       10.1kB             0B    U   
ubuntu:22.04                                                  9fa3e2b5204f       77.9MB             0B        
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons_new/docker_humble_desktop$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-new
12744651417
mtv@x570:~/Documents/GitHub/docker-rework/docker_commons_new/docker_humble_desktop$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-new
3851948482

-------------------
New containers sizes:
-------------------
mtv@x570:~/Documents/GitHub/docker-rework$ docker image ls
                                                                                                       i Info →   U  In Use
IMAGE                                                         ID             DISK USAGE   CONTENT SIZE   EXTRA
ghcr.io/epflxplore/cs:humble-desktop-new                      8dd5b10cec1d       4.09GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop-new          659658da7cfd       3.85GB             0B        
ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-new   1dc8571d29ff       12.7GB             0B        
ghcr.io/epflxplore/elec:humble-desktop-new                    87c659dfaf61       6.48GB             0B        
ghcr.io/epflxplore/hd:humble-desktop-new                      715278d5cafd       12.7GB             0B        
ghcr.io/epflxplore/nav:humble-desktop-new                     c8adf629fee9       15.8GB             0B        
ghcr.io/epflxplore/rover:humble-desktop-new                   fd79595060ba       4.17GB             0B        
ghcr.io/epflxplore/sc:humble-desktop-new                      74f3686d0816       12.8GB             0B        
hello-world:latest                                            1b44b5a3e06a       10.1kB             0B    U   
ubuntu:22.04                                                  9fa3e2b5204f       77.9MB             0B        
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/elec:humble-desktop-new
6477639246
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/cs:humble-desktop-new
4085185998
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/rover:humble-desktop-new
4166916563
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/hd:humble-desktop-new
12680638044
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop-new
15802006566
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop-new
12757166158

---------------------
New commands with another gazebo layer
---------------------
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-reduced --target gazebo_nvidia_new .
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/nav:humble-desktop-reduced -f Dockerfile ..
docker build --pull=false --no-cache --progress=plain -t ghcr.io/epflxplore/sc:humble-desktop-reduced -f Dockerfile ..
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-reduced
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop-reduced
docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop-reduced

---------------------
New docker_commons and containers with another gazebo layer images sizes:
---------------------
mtv@x570:~/Documents/GitHub/docker-rework$ docker image ls
                                                                                                       i Info →   U  In Use
IMAGE                                                             ID             DISK USAGE   CONTENT SIZE   EXTRA
ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-reduced   04a744bb35cb       7.52GB             0B        
ghcr.io/epflxplore/nav:humble-desktop-reduced                     75d9a803a84a       10.6GB             0B        
ghcr.io/epflxplore/sc:humble-desktop-reduced                      31648a4cf569       7.53GB             0B        
hello-world:latest                                                1b44b5a3e06a       10.1kB             0B    U   
ubuntu:22.04                                                      9fa3e2b5204f       77.9MB             0B        
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/docker_commons:humble-desktop-nvidia-reduced
7520350387
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/nav:humble-desktop-reduced
10577626998
mtv@x570:~/Documents/GitHub/docker-rework$ docker inspect -f "{{ .Size }}" ghcr.io/epflxplore/sc:humble-desktop-reduced
7532787626

---------------------
Changes made:
---------------------
# Base image (xplore_common):
- Stock: 4.04 GB → New: 3.85 GB
- Savings: 190 MB (4.7% reduction)

# Nvidia Gazebo image (gazebo_nvidia):
- Stock: 13.0 GB → New (cuda-libraries): 12.7 GB → Reduced (runtime-only): 7.52 GB
- Savings with cuda-libraries: 297 MB (2.3% reduction)
- Savings with runtime-only: 5.48 GB (42.2% reduction)
- Total reduction from stock to reduced: 5.52 GB

# Individual containers comparison (Stock → New → Reduced):
- elec: 6.88 GB → 6.48 GB (savings: 403 MB, 5.9%)
- cs: 4.36 GB → 4.09 GB (savings: 279 MB, 6.4%)
- rover: 4.82 GB → 4.17 GB (savings: 657 MB, 13.6%)
- hd: 13.0 GB → 12.7 GB (savings: 283 MB, 2.2%)
- nav: 16.4 GB → 15.8 GB → 10.6 GB (reduced savings: 5.8 GB, 35.4%)
- sc: 13.1 GB → 12.8 GB → 7.53 GB (reduced savings: 5.59 GB, 42.7%)

# Key optimization: gazebo_nvidia_new layer
- Removed full cuda-toolkit-11-8 (~6 GB)
- Installed only CUDA runtime libraries (~2 GB):
  * cuda-cudart-11-8
  * cuda-libraries-11-8 (includes cuBLAS, cuFFT, cuRAND, cuSOLVER, cuSPARSE, NPP, nvJPEG)
- Kept nvidia-driver-470
- Kept ignition-fortress

---------------------
Size Comparison Table:
---------------------

## Docker Commons Base Images

| Image                        | Stock    | New      | Reduced  | Stock→New Savings | Stock→Reduced Savings |
|------------------------------|----------|----------|----------|-------------------|-----------------------|
| xplore_common                | 4.04 GB  | 3.85 GB  | 3.85 GB  | 190 MB (4.7%)     |                       |
| gazebo_nvidia                | 13.0 GB  | 12.7 GB  | 7.52 GB  | 297 MB (2.3%)     | 5.52 GB (42.4%)       |

## Individual Containers

| Container | Stock    | New      | Reduced  | Stock→New Savings | Stock→Reduced Savings | Uses GPU |
|-----------|----------|----------|----------|-------------------|-----------------------|----------|
| elec      | 6.88 GB  | 6.48 GB  | -        | 403 MB (5.9%)     | -                     | No       |
| cs        | 4.36 GB  | 4.09 GB  | -        | 279 MB (6.4%)     | -                     | No       |
| rover     | 4.82 GB  | 4.17 GB  | -        | 657 MB (13.6%)    | -                     | No       |
| hd        | 13.0 GB  | 12.7 GB  | -        | 283 MB (2.2%)     | -                     | Yes      |
| nav       | 16.4 GB  | 15.8 GB  | 10.6 GB  | 604 MB (3.7%)     | 5.80 GB (35.4%)       | Yes      |
| sc        | 13.1 GB  | 12.8 GB  | 7.53 GB  | 364 MB (2.8%)     | 5.59 GB (42.7%)       | Yes      |

## Total Deployment Size (All 6 Containers)

| Version          | Total Size | Savings vs Stock |
|------------------|------------|------------------|
| Stock            | 59.3 GB    | -                |
| New              | 55.9 GB    | 3.4 GB (5.7%)    |
| Reduced (nav+sc) | 49.5 GB    | 9.8 GB (16.5%)   |

## Key Changes

**Reduced (runtime-only):**
- Removed unnecessary packages from xplore_common
- Replaced `cuda-toolkit-11-8` with `cuda-libraries-11-8` meta-package
- Same as New, plus:
- Installed only essential CUDA runtime libraries:
  - `cuda-cudart-11-8` (CUDA Runtime API)
  - `cuda-libraries-11-8` (includes cuBLAS, cuFFT, cuRAND, cuSOLVER, cuSPARSE, NPP, nvJPEG)
- Removed redundant individual library packages
- Kept `nvidia-driver-470` and `ignition-fortress`